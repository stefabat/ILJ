\documentclass[utf8]{article}

\usepackage{preamble}

\graphicspath{{figures/}}
\makeatletter
\def\input@path{{figures/}{tables/}}
\makeatother

\input{figures}
\input{tables}

\title{\LARGE Static and Dynamics of the Azide Anion Confined in an Armchair Carbon Nanotube}

\author{Stefano Battaglia}

\begin{document}

\maketitle

\section{Introduction}
Introduction

\section{Computational Details}
The computational details section is divided in two parts.
The first one describes the details of the \textit{ab-initio} calculations performed in order to obtain accurate interaction energies and partial atomic charges of the two fragments.
The second one describes the analytical potential employed in the molecular dynamics (MD) simulations and assesses its performance against the \textit{ab-initio} values.


\subsection{\textit{Ab-Initio}}
At \textit{ab-initio} level, carbon nanotubes (CNTs) have been treated as finite-size systems and the two open ends have been capped with hydrogen atoms in order to fill out the valence shell. Only one type of armchair nanotube has been considered, with chiral indices $(5,5)$. In order to obtain converged values with respect to the length of the nanotube, CNTs with different number of units have been considered. Therefore, we introduce here the notation $\Lambda$-$(5,5)$CNT to label a nanotube composed by $\Lambda$ units, where a single unit corresponds to a [$10$]cyclophenacene (see FIGURE).


\subsubsection{Geometries}
The geometries of the nanotubes and the azide anion have been optimized using restricted Kohn-Sham density functional theory (DFT), employing the B97D3 exchange-correlation functional with Becke-Johnson damping\cite{Grimme2010,Grimme2011}.
For both fragments Dunning's triple-$\zeta$ cc-pVTZ basis set\cite{DunningJr1989} has been used, with the addition of diffuse functions (aug-)\cite{Kendall1992} in the case of the \ntm fragment.\\
The nanotubes geometries retained the high $D_{5d}$ symmetry, with both parallel and perpendicular (to the principal axis) C--C bonds showing the typical alternation pattern of these systems when treated with open boundary conditions\cite{Zhou2004,Galano2006}. As the length of the nanotube increases, the average C--C bond length approaches the experimental value of 1.421 \AA\ [REFERENCE].\\
The relaxed \ntm geometry has linear $D_{\infty h}$ symmetry, with an N--N bond length of $1.1874$ \AA, which is in excellent agreement with the experimental gas phase value of $1.1884$ \AA\cite{Polak1987}.\\
All the optimizations have been performed using the Gaussian 09 software package, revision d01\cite{g09}, using the default convergence thresholds, the ultrafine grid for the integral quadrature and spherical harmonics \textit{d} and \textit{f} functions.


\subsubsection{Interaction Energies}
In order to construct the classical force field (cf. Molecular Dynamics section), the most important parameter to obtain is the interaction energy of the the guest \ntm ion and the host carbon nanotube at the optimal adsorption distance.
In this contribution, all interaction energies computed using first-principles methods have been evaluated according to the formula
%
\begin{equation}
    E_{int} = E_{complex} - (E_{cnt} + E_{azide}) \label{eq:eint}
\end{equation}
%
where the fragment energies $E_{cnt}$ and $E_{azide}$ have been computed using the basis set of the complex system, thus correcting the basis set superposition error according to the Boys and Bernardi scheme\cite{Boys1970}.
Relaxation effects on the two interacting fragments have not been taken into account, although it has been recently shown that these effects contribute only in the order of 1--2 kcal/mol\cite{Battaglia2017a} to $E_{int}$ and thus do not substantially modify the overall picture.\\
To locate the minimum of the potential energy surface (PES), a series of constrained optimizations involving nanotubes of lengths between 3 and 9 units has been performed. In these optimizations, the optimal geometry of the two fragments has been kept frozen and only their relative distance and orientation have been optimized, thus locating the adsorption distance.
This series of optimizations has been performed at the same level of theory as before, employing the smaller cc-pVDZ basis set on the nanotube, the resolution of the identity technique with the auxiliary basis def2/J by Weigend \textit{et al.}\cite{Weigend2006}, using the ORCA program package, version 4\cite{ORCA}.\\
Remarkably, it turns out that in the particular case of an azide anion confined inside a $(5,5)$CNT, the geometry with the \ntm molecule placed exactly in the center of the nanotube, aligned to its principal axis, results to be a local minimum. Moreover, the difference between this minimum and the lowest minimum found is at maximum less than $0.6$ kcal/mol for the nanotubes studied. For this reason, the geometry with the \ntm molecule placed in the center of the CNTs has been used for the calculation of $E_{int}$ at higher levels of theory and for longer nanotubes.
For a detailed explanation of the structure optimizations, the criteria used to compare the them and all the geometries, we point the reader to the Supplementary Information.\\

%%%%
As we are dealing with finite size CNTs, it is important to study the dependence of the interaction energy with respect to the length of the nanotube. In particular, given that the confined species is negatively charged, one expects a slower convergence compared to uncharged systems due to the typically more diffuse electron density of anions.\\
Accurate interaction energies have been calculated at wave function level of theory, using the spin-component-scaled MP2 method (SCS-MP2)[REFERENCE] and the local coupled cluster method DLPNO-CCSD(T) as implemented in the ORCA 4 program [REFERENCE]. Calculations have been performed using the cc-pVDZ or the cc-pVTZ basis set (where computationally feasible) and in both cases diffuse functions (aug-) have been added on the \ntm ion.\\
FIGURE X depicts the results obtained for nanotubes of different lengths, where it is immediately clear that interaction energy shows a slow convergence rate with respect to $\Lambda$.
In order to obtain accurate interaction energies, extrapolated DLPNO-CCSD(T)/cc-pVTZ values have been obtained using the following formula
%
\begin{equation}
    E_{CC}(pVTZ) \approx E_{MP2}(pVTZ) + (E_{CC}(pVDZ) - E_{MP2}(pVDZ)) \label{eq:basis_extr}
\end{equation}
%
where it is assumed that the correlation energy difference between the two methods is constant with respect to the basis set used.
This approach has allowed us to obtain accurate values for nanotubes of length 3, 5 and 7. Nonetheless, as it can be seen from the RI-SCS-MP2/cc-pVDZ curve in FIGURE X, $E_{int}$ still significantly decreases with the addition of of extra nanotube units.
Therefore, in order to be able to extrapolate the DLPNO-CCSD(T)/cc-pVTZ confinement energy inside an arbitrary $\Lambda$-(5,5) nanotube we propose the following formula
%
\begin{equation}
    E_{int}(\Lambda) = \frac{a\Lambda}{b + \Lambda} \label{eq:length_extr}
\end{equation} 
%
where $a$ and $b$ are two fitting parameters to be determined.
\Cref{eq:length_extr} is the simplest formula which satisfies the condition $E_{int}(0) = 0$ and provides and estimates for the infinitely long nanotube through the parameter $a$.\\
The solid line in FIGURE X shows the fit to the three approximated DLPNO-CCSD(T)/cc-pVTZ interaction energies computed according to \cref{eq:basis_extr}. 
For a detailed explanation of the parameters used in the calculation and the tests performed to assess the validity of our approach, we point the reader to the Supplementary Information.\\
In \fref{fig:n3t55x_eint} we see the resulting values.


\subsection{Molecular Dynamics}
The Improved Lennard-Jones (ILJ) potential is given by
%
\begin{equation}
    V_{ILJ}(r) = \epsilon \left[ \frac{m}{n(r)-m} \cdot \Big( \frac{r_0}{r} \Big)^{n(r)} -
                                 \frac{n(r)}{n(r)-m} \cdot \Big( \frac{r_0}{r} \Big)^{m} \right]
\end{equation}
%
where
%
\begin{equation}
    n(r) = \beta + 4.0 \cdot \Big( \frac{r}{r_0} \Big)^2
\end{equation}
%
and $r = R_{i,j}$ is the distance between carbon atom $i$ and nitrogen atom $j$. The parameters $r_0$, $\epsilon$ and $\beta$ are set according to the atoms interacting, while $m$ is set according the to the partial charges of the interacting species.
The induction potential term for a $\text{N}_3^-$ anion interacting with carbon atoms is given by
%
\begin{equation}
    V_{ind}(R_{i,1},R_{i,2},R_{i,3}) = - \frac{1}{2} \cdot \alpha_C \cdot \frac{n(R_{i,2})}{n(R_{i,2}) - 4}
                        \left[ \frac{Q_{N_1}}{R_{i,1}^2} + \frac{Q_{N_2}}{R_{i,2}^2} + \frac{Q_{N_3}}{R_{i,3}^2} \right]^2
\end{equation}
%
where $R_{i,1}$, $R_{i,2}$ and $R_{i,3}$ are the distances between the carbon atom $i$ and the three nitrogen atoms, $Q_{N_1}$, $Q_{N_2}$ and $Q_{N_3}$ are the partial charges on the nitrogen atoms, $\alpha_C$ is the polarizability of the carbon atoms and $n(R_{i,2})$ is equal to $n(r)$ using $r_0$ according to the interaction between $C-N_2$.\\
Because we are using a finite-size model for the carbon nanotube, saturated with hydrogen atoms at the two ends, the nanotube wall is polarized.
The interaction between the azide anion and the nanotube contains therefore a significant electrostatic contribution, which cannot be neglected.
The electrostatic potential term is given by the following formula
%
\begin{equation}
    V_{els}(R_{i,j}) = \sum_{i,j} \frac{Q_i Q_j}{R_{i,j}}
\end{equation}
%
where the sum runs over all atoms of the two fragments and takes into account all pairwise electrostatic interactions between them.
The total interaction energy between the azide anion confined inside a carbon nanotube is given by
%
\begin{align}
    E_{int} = \Bigg[ \sum_{i=1}^{N_C} V_{ind}(R_{i,1},R_{i,2},R_{i,3}) +
              \sum_{j=1}^{N_N} V_{ILJ}^{C-N_{j}}(R_{i,j}) + V_{els}(R_{i,j}) \Bigg] +
              \sum_{k=1}^{N_H} \sum_{j=1}^{N_N} V_{els}(R_{k,j})
\end{align}
%
where $N_C$, $N_N$ and $N_H$ correspond to the total number of carbon, nitrogen and hydrogen atoms, respectively.
The ILJ potential $V_{ILJ}^{C-N_j}$ is defined according to the parameters given in \tref{tab:ILJ_parms} and the polarizability $\alpha_C$ appearing in $V_{ind}$ is set to $1.2$, the partial charges as $Q_{N_1} = Q_{N_3} = -0.56$ and $Q_{N_2} = 0.12$ and finally the term $\tfrac{n}{n - 4}$ is assumed to be $1.0$ for the time being.\\
In order to test the performance of the classical potential, we have computed the interaction energy between the azide anion and a short 3-CNT(5,5) nanotube at \textit{ab-intio} level and compared it with the result obtained by the potential, as shown in \tref{tab:n3_t553_ILJ_eint}.\\
Similarly, we have compared the interaction energies for the confinement in a longer 5-CNT(5,5), listed in \tref{tab:n3_t555_ILJ_eint}.
Moreover, \tref{tab:n3_t557_ILJ_eint}, \tref{tab:n3_t559_ILJ_eint}, \tref{tab:n3_t5511_ILJ_eint} and \tref{tab:n3_t5513_ILJ_eint} list the results for longer nanotubes.
A comparison of the interaction energy computed by different dft functionals is listed in \tref{tab:n3_t553_dft_comp}, while a comparison of the electrostatic term with respect to the basis set used in the calculation can be seen in \tref{tab:els_basis_comp}.

\clearpage
%%%%%%%%%%%%%%%%
Since the aim is to fit the potential to the max interaction energy only (i.e. to fit the well depth $\epsilon$), a very accurate value for this interaction energy is required. In order to do so, an elaborate scheme is required, which involves several steps.\\
%
\begin{enumerate}
    \item Geometry relaxation of the complex system and the monomers. The nanotube length is only 3 units, otherwise there are too many basis functions
    \begin{enumerate}
        \item Using one pure functional among PBE, B97 and TPSS
        \item Using Grimme dispersion with Becke and Johnson damping (D3BJ)
        \item Using the cc-pvtz basis set on the CNT and the aug-cc-pvtz on the nitrogen (diffuse functions also on the tube lead to linear dependence)
        \item Now testing density fitting in Gaussian, if much faster, we use also that for the pure functional with the universal def2/j basis set
        \item Using one hybrid functional among B3LYP, APFD, what else?
    \end{enumerate}
    \item All the geometry calculations are performed in Gaussian
    \item To obtain accurate interaction energies, there is a total of 7 single point calculations to be performed
    \begin{enumerate}
        \item Complex at the complex geometry in the full basis
        \item First monomer at the complex geometry in the full basis
        \item First monomer at the complex geometry in the monomer basis
        \item First monomer at the monomer geometry in the monomer basis
        \item Second monomer at the complex geometry in the full basis
        \item Second monomer at the complex geometry in the monomer basis
        \item Second monomer at the monomer geometry in the monomer basis
    \end{enumerate}
    \item The series of 7 calculations just listed has to be done for two basis sets, to be able to extrapolate the results at CBS limit
    \item The extrapolation schemes are different for SCF and correlated calculations, therefore they can be done separately
    \item For the SCF extrapolation, we can compute in Gaussian using triple and quadruple zeta basis sets
    \item For the correlated extrapolation, we can compute in ORCA using double and triple zeta basis sets (which will give us also dz scf points)
    \item The SCF in this case does not use the RI approximation for both Gaussian and ORCA
    \item The correlated method is the DLPNO-CCSD(T)
    \item Partial charges have to be obtained and there are many ways to do it. First of all, we need to decide which density to use
    \begin{enumerate}
        \item The density (relaxed, unrelaxed, linearized?) of the DLPNO-CCSD(T) method (I do not know how much expensive it is)
        \item Find a DFT functional in which we can trust (how?) and use its density
        \item Use the density of DLPNO-SCS-MP2 if it reproduces well the CCSD(T) one. But the same problem as above (relaxed, unrelaxed, linearized? Expensive?)
    \end{enumerate}
    \item Once we know which density we want to use, calculate the charges
    \begin{enumerate}
        \item NPA charges from NBO analysis
        \item MESP derived charges
        \item Many other possibilities...
    \end{enumerate}
    \item Calculate multipole moments with the charges obtained and compare them with the moments obtained from the calculation
\end{enumerate}
%
The above computational scheme will provide a very accurate interaction energy and can be ideally applied to different systems. The major pitfall of the above procedure, is the very first step, i.e. the geometry optimization.
%
\begin{enumerate}
    \item The functional used for the geometry optimization might give wrong conformations
    \item One should optimize the geometry using a wf method, but if it is too expensive we cannot
    \item Moreover there are a plethora of minima in the PES, several starting geometries have to be relaxed and compared with each other
\end{enumerate}
%
\medskip
With the interaction energy and the partial charges, we can tune the ILJ potential such that it reproduces the interaction energy obtained with the above scheme.\\
\newline
There is a large amount of arbitrariness in this procedure to obtain the ILJ potential.
The partial charges calculated are in principle arbitrary and considering them explicitly enhances the complexity of the problem. In particular, the charges will certainly vary depending on the length of the nanotube. This means that if we would like to use longer CNTs in the MD simulation, then the tuned ILJ potential which includes explicitly the charges might not be valid anymore.
I believe that therefore we cannot pursue this approach.\\
A possible solution would be to fit the ILJ potential to a series of calculations of the complex system at different conformations. In this way, the electrostatic effects would be implicitly taken care of in the fitting procedure. Nonetheless, for such a fit, the above procedure is certainly to expensive and one should come up with a reasonable approximation.\\
Another possibility is to neglect completely the electrostatic term in the potential and tune it just according dispersion and induction forces. This is basically the same as the above solution, but without fitting the entire potential and only relying on the single interaction energy value.\\
A last idea is to assume that in the limit of a very long nanotube, the polarization far away from the nanotube ends is minimal and has to be taken care only locally around the azide anion. This would mean that the partial charges are assigned only locally around the azide anion and they would need to be approximated in some way. One such way is to compute them for a nanotube of increasing length and observe how they change. If the change is minimal, they can be safely assumed to remain so for any length, if this is not the case, then probably this idea is not feasible.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\bibliographystyle{unsrt}
\bibliography{library}

\clearpage
\section{Supplementary Information}
To ensure that the relaxation process did not remain trapped in a local minimum and without knowing a priori the optimal adsorption distance of the N$_3^-$ molecule, the optimization procedure has been started from four different geometries.
In all cases, the anion has been placed parallel to the principal axis of the nanotube.
Three starting geometries were chosen according to possible ``adsorption'' sites in which the central nitrogen atom of the azide was placed either over C--C bonds (\textit{bond} (b) and \textit{zigzag} (z) geometries) or in the center of an hexagonal ring of the CNT wall (\textit{hollow} (h) geometry). The three starting sites are shown in \fref{fig:n3t553_start_sites}, along with their labels that will be used in the following to refer to them. For all three cases, the azide anion has been placed at a distance of about $2.25$\AA\ from the nanotube wall, well below the optimal adsorption distance.
The fourth starting geometry is shown in \fref{fig:n3t553_start_center} and it simply consists in the N$_3^-$ anion placed exactly in the center of the nanotube. We will refer to this starting geometry as \textit{central} (c) geometry.
In order to study the edge effects on the position of the minimum, CNTs of four different lengths have been considered, namely with 3, 5, 7 and 9 units.
The relaxation has been performed again at DFT level using the B97D3 functional, but this time with the smaller cc-pvdz\cite{DunningJr1989} basis set on the carbon nanotube and the aug-cc-pvtz\cite{DunningJr1989} on the N$_3^-$.
The resolution-of-the-identity (RI) approximation has been used to compute the Coulomb matrix, adopting the universal fitting basis set def2/j\cite{Weigend2006}. The calculations have been performed using the ORCA 4 program package\cite{ORCA4}.\\
The relaxed structures starting from the (c) geometry correspond to a (local) minimum, as after one optimization step the convergence is reached, with the \ntm anion insignificantly ($\approx 0.002$\AA) shifted out of the principal axis. For this reason we will consider from now on the (c) geometry as the perfectly aligned anion to the principal axis and sitting in the center of the nanotube.
For the three other starting conformations, namely the the (b), (h) and (z) geometries, the relaxation leads to different (local) minima.
In order to analyze the differences in the final structures, three geometrical parameters and an energetic one have been considered.
The geometrical parameters are depicted in \fref{fig:n3t553_geom_parms} and consist in the axial distance $d_{cm}$ between the center of mass of the azide anion and the center of mass of the carbon nanotube, the radial distance $r_{axis}$ of the azide anion center of mass from the principal axis of the nanotube and the angle $\theta$ formed between the principal axis and an imaginary line passing through the external nitrogen atoms of the azide anion.
The energetic parameter is the interaction energy $E_{int}$ between the two fragments, computed as
%
\begin{equation}
    E_{int} = E_{complex} - (E_{cnt} + E_{azide})
    \label{eq:eint}
\end{equation}
%
and corrected for the basis set superposition error according to the Boys and Bernardi scheme\cite{Boys1970}.
Note that although geometry optimizations have been carried out on the complex systems, the geometry of the two fragments was kept frozen at the optimal fragment conformation, thus the value obtained from \Cref{eq:eint} is only the interaction energy and not the binding energy of the system (i.e. it does not account for deformation effects).\\
The four parameters computed for all systems are listed in \tref{tab:geom_comp}. Since the (c) geometry consists in the azide ion sitting in the exact center of the nanotube, the three conformational parameters are all zero in this case, thus for geometries (b), (h) and (z), the parameters can be considered as differences from the (c) geometry. Accordingly, instead of tabulating the interaction energy for every geometry, the values listed in the last column of \Cref{tab:geom_comp} correspond to the interaction energy difference between the (c) geometry and the other three, i.e. $\Delta E_{int} = E_{int}(c) - E_{int}(site)$. A negative value for $\Delta E_{int}$ means that the interaction energy is more favorable (i.e. stronger) for the (c) geometry, while a positive value the opposite.\\
For all final geometries, the azide anion is found to be almost perfectly aligned to the principal axis of the nanotube since the angle $\theta$ is always very small (below $1^{\circ}$ except in one case), confirming the results presented in \cite{Battaglia2017a}.
Similarly, $r_{axis}$ is also always particularly small (most of the times below $0.01$ \AA), meaning that the anion has the preference to stay approximately at the same distance from the nanotube wall in all directions.
In particular, independently from the length $\Lambda$, the azide ion is adsorbed at a distance of approximately $3.34$ \AA\ (computed as the distance between the \ntm center of mass and the closest side of the wall). This value is significantly larger than the adsorption distance of $3.17$ \AA\ found for the confinement in a larger 3-CNT(6,6), obtained following the same computational procedure.
There are two possible explanations for the difference in the adsorption distance. Either the different curvature of the two nanotubes is such that the forces attracting the ion are stronger in the case of the (6,6) CNT, or in the case of the (5,5) CNT, there is a competition between the attractive forces exerted by the surrounding wall on the azide ion, which eventually stabilizes it at an (almost) equal radial distance in any direction.
The analysis of the curvature effects on the adsorption distance inside the CNT are beyond the scope of this work, and thus not further investigated here [maybe there are refs for other systems, probably H2 and H2O].
The most fluctuating parameter is $d_{cm}$. Clearly, the periodic atomic pattern of the carbon nanotube makes the potential energy surface (PES) of the complex full of local minima, all of which approximately share the same well depth. Apart from the (z) conformation, for which $d_{cm}$ remains virtually unchanged irrespective of the length, it is hard to rationalize the results for the (b) and (h) cases.
The only exception is found for the 3-CNT(5,5), where the two open ends of the nanotube are so close that the energy barriers to move away from the center are particularly steep.
Nonetheless, although the evident difference between the final geometries, the effect observed on the interaction energy, which is our first and most important parameter that we are interested in, is minimal and, importantly, below chemical accuracy ($\approx 1$ kcal/mol).
As it appears a very hard task to find the \emph{global minimum} for this type of systems and considering the small influence observed on the interaction energy as well as remembering that the accuracy of classical parametrized potentials is well below the differences $\Delta E_{int}$ listed in \Cref{tab:geom_comp} [maybe ref?], the central geometry (c) will be used for all interaction energies computed in this work at a higher level of theory and for nanotubes longer than $\Lambda = 9$.\\


\end{document}
